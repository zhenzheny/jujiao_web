<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta content="telephone=no" name="format-detection">
		<meta name="x5-orientation" content="portrait">
		<!-- UC强制全屏 -->
		<meta name="full-screen" content="yes">
		<!-- QQ强制全屏 -->
		<meta name="wap-font-scale" content="no">
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
        <title>秒杀课</title>
        <link href="../css/index.css?+Math.random()" rel="stylesheet">
        <link href="../css/scrollbar.css" rel="stylesheet">
		<style>
			@font-face {
				font-family: 'iconfont';  /* project id 426310 */
				src: url('//at.alicdn.com/t/font_426310_gc3w8eg1hrc6jemi.eot');
				src: url('//at.alicdn.com/t/font_426310_gc3w8eg1hrc6jemi.eot?#iefix') format('embedded-opentype'),
				url('//at.alicdn.com/t/font_426310_gc3w8eg1hrc6jemi.woff') format('woff'),
				url('//at.alicdn.com/t/font_426310_gc3w8eg1hrc6jemi.ttf') format('truetype'),
				url('//at.alicdn.com/t/font_426310_gc3w8eg1hrc6jemi.svg#iconfont') format('svg');
			}
			.controller{
				width: 100%;background: #fff;
				height: 40px;
				display: flex;
				justify-content: space-between;
				cursor:pointer;
			}
			.start{
				width: 40px;
				height: 40px;
				font-family: 'iconfont';
				color: #666;
				font-size: 20px;
				line-height: 40px;
			}
			.icon{
				width: 40px;
				height: 40px;
				font-family: 'iconfont';
				color: #666;
				font-size: 20px;
				line-height: 40px;
				text-align: center;
			}
			.progress{
				width:auto;
				height: 2px;
				background:#eee;;
				flex-grow:1;
				margin-top: 18px;
				border-radius:5% 5%;
			}
			.inner{
				width: 0%;
				height:2px;background: #999;
			}
		</style>
    </head>
    <body class="marginNone padBottom20 theBody">
        <div class="videoBlock offlineBlo">
		  <div id="mediaplayer">
			  </div>
		  </div>
        <div class="mainContent marginBody leftRight" id="vedioPrice">
			<!--视频下方-->
		</div>
		<div id="hasTuan" style="display: none;">
			<div class="clearance padLeftRight">
			以下小伙伴正在发起团购 , 人数不足自动退款
		</div>
		 <div class="tuanList borBottom">
	    	<div class="webkBlo">
	    		<p class="tuanPeo"><img src="../images/jigGou.png" />
	    		dddd
	    		</p>
	    		<div class="webInp tuanNumCon">
	    			<p class="chaHow">
	    				还差<span class="redFont">22</span>人成团
	    			</p>
	    				 <p id="times1"><span class="greyFont">剩余:</span><span class="time date"></span> 天 <span class="time hour"></span>:<span class="time minutes"></span>:<span class="time seconds"></span>
	    				 </p>
	    		</div>
	    		<p class="goToTuan">
	    			去参团
	    		</p>
	    	</div>
	    </div>
	    <div class="tuanList">
	    	<div class="webkBlo">
	    		<p class="tuanPeo"><img src="../images/jigGou.png" />
	    		ddd
	    		</p>
	    		<div class="webInp tuanNumCon">
	    			<p class="chaHow">
	    				还差<span class="redFont">22</span>人成团
	    			</p>
	    				 <p id="times2"><span class="greyFont">剩余:</span><span class="time date"></span> 天 <span class="time hour"></span>:<span class="time minutes"></span>:<span class="time seconds"></span>
	    				 </p>
	    		</div>
	    		<p class="goToTuan">
	    			去参团
	    		</p>
	    	</div>
	    </div>
		</div>
        <ul class="tabUl padLeftRight borBottom borTop">
            <li class="active">
                <span>
                    目录
                </span>
            </li>
            <li>
                <span>
                    详情
                </span>
            </li>
            <li>
                <span>
                    评价
                </span>
            </li>
        </ul>
        <div class="tabBlock">
            <div class="tabContent">
                <div class="tabCon">
                    <div class="padLeftRight padBottom20">
                        <p class="title color2C outLine">
                            课程提纲
                        </p>
                        <div id="MuluId">
                            <!--目录-->
                        </div>
                    </div>
                </div>
                <div class="tabCon disNone">
					<!--老師   頭像   機構-->
					<div class="teacherMes borBottom borBottom1" id="teacherMes">
						<div class="teacherImg"></div>
						<div class="teachIntro"></div>
					</div>
					<div class="padLeftRight padBottom20" id="corseXuZhi">
		           </div>
		          <a class="disBlock">
		            <div class="agencyName borBottom borTop padLeftRight webkBlo" id="jiGouCon">

		            </div>
		          </a>
                </div>
                <div class="tabCon disNone padLeftRight">
                    	<p class="title color2C size13 padTop20 marBottom10">
           					<span class="greyFont size12">综合评分</span><span id="score"></span>
                    	</p>
                    	<div class="lunRelative">
							<div id="wrapper">
							<div id="scroller" >
								<div id="pullDown" style="overflow: hidden;">
									<span class="pullDownIcon"></span><span class="pullDownLabel">下拉刷新...</span>
								</div>
								<div id="pingLun"></div>
								<div id="pullUp" class="pullUp" style="overflow: hidden;">
									<span class="pullUpIcon"></span><span class="pullUpLabel"></span>
								</div>
							</div>
							</div>
						</div>
                </div>
            </div>
        </div>
        <script src="../js/zepto.js"></script>
   		<script src="../jwplayer/jwplayer.js"></script>
  		<script src="../jwplayer/jwpsrv.js"></script>
        <script src="../js/iscroll.js"></script>
		<script src="../js/iscroll4.2.5.js"></script>
		<script src="../js/startScore.js"></script>
		<script src="../js/common.js"></script>
		<script src="../js/layer.js"></script>
        <script>
            !(function($) {
                var g = {
                    init: function() {
                        var _t = this;
                        //调用tab
                        _t.tab();
                        /*一元课详情*/
                        _t.keDetail();
                        /*目录*/
                        _t.directory();
                        /*评价*/
                      _t.evaluation();
                      /*加载图片失败*/
                     _t.default();
                    },
                    //调用tab
                    tab: function() {
                        var _t = this;
                        $(".tabUl li").each(function(index, element) {
                            var i = index;
                            $(this).on('click',
                            function() {
                                $(".tabUl li").removeClass("active");
                                $(this).addClass("active");
                                $(".tabContent .tabCon").hide();
                                $(".tabContent .tabCon").eq(i).show();
                            });
                        });
                    },
                    keDetail: function() {
                        var _t = this;
                        //通过链接获取id
		            	var url=location.search;
						if(url.indexOf("?")!=-1)
						{
							function GetQueryString(name)
							{
							     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
							     var r = window.location.search.substr(1).match(reg);
							     if(r!=null)return  unescape(r[2]); return null;
							}
							GetQueryString("id");
							var idNum=GetQueryString("id");
							var userId=GetQueryString("user_id");
							var relaId=idNum;
							var uId=userId;
							var parm={"id":idNum,"user_id":userId};
							}
							else{
								var parm={"id":1,"user_id":1};
								var relaId=1;
								var uId=1;
							}
                        $.ajax({
                            type: 'POST',
                            url: jieUrl+'207',
                            data: parm,
                            headers:{ut:tokenData},
                            dataType: 'json',
                            success: function(data) {
                                var data = data.d;
                                if(data.type==1){
                                	$("#my-video").show();
                                	var con1="<p class='redBiao marBottom10 marTop10'>"+(data.category_name==null?" ":data.category_name)+"</p>\
									<p class='titleKe color333 marBottom7'>"+data.title+"</p>";
									if(data.complex==undefined){
										var con2="<p class='greyFont size10'>"+data.study_num+"人学过&nbsp;|&nbsp;0星评价</p>";
									}else if(data.complex==null){
										var con2="<p class='greyFont size10'>"+data.study_num+"人学过&nbsp;|&nbsp;0星评价</p>";
									}else{
										var con2="<p class='greyFont size10'>"+data.study_num+"人学过&nbsp;|&nbsp;"+((data.complex).toFixed(1))+"星评价</p>";
									}
					              	if(data.kill_price==0){
						              		var pCon='<p class="redFont price blueFree">免费</p>';
						              		con1+=pCon;
						              	}else{
						              		var pCon2="<p class='redFont price'>￥"+((data.kill_price).toFixed(2))+"<span class='greyFont del'>￥"+data.fee+"</span></p>";
						              		con1+=pCon2;
						              	}
					              	$("#vedioPrice").html(con1);
	                                var yiYuanCon = "<p class='redBiao marBottom10 marTop10'>" + data.category_name + "</p>" + "<p class='titleKe color333 marBottom7'>" + data.title + "</p>" + "<p class='moneyTime marBottom10 overHide'>" + "<span class='redFont marRight5'>￥<font class='size13'>1</font></span>" + "<span class='coloe9a delFont marRight5'>1999</span>" + "<span class='coloe9a marRight9'>" + data.start_time + "开课</span></p>";
	                                $("#underVideo").html(yiYuanCon);
                                }else if(data.type==2){
                                	 $(".videoBlock").html("");
	                                var conLine="<div class='agencyName padLeftRight webkBlo'><p class='agencyImg marRight9' id='teaDetail'>"+
	                                "<img src='"+data.teacher_img_url+"' class='marBottom7'>"+
	                                "<span class='guWenPer'><img src='../images/crown.png' class='marRight5'>"+data.lecturer+"<span class='greyEr size12'>"+
	                                "</span></span></p><div class='agencyMes webInp'><div class='agencyUl' id='courseFenQi'><div class='xian-imgcon'>"+
	                                "<p class='teaTitle marTop4'>"+data.title+"</p><p class='coloe9a'>"+data.start_time+"开课</p></div>"+
	                                "<p class='coloe9a size12 height14 marTop7'>"+data.study_num+"人学过&nbsp;|&nbsp;"+(data.complex==null?" ":(data.complex).toFixed(1))+"星评价</p><p class='coloe9a size12 height14'>"+
	                                "</p><div class='redFont textRight'><span class='price marRight9'><font class='size12'>￥</font>"+((data.fee).toFixed(2))+"</span></div>"+
	                                "</div></div></div>";
	                                $(".videoBlock").html(conLine);
                                }
								/*老师详情*/
								var teacherDetail="<img src='"+(data.league_logo==null?data.teacher_img_url:data.league_logo)+"'/>";
								$(".teacherImg").html(teacherDetail);
								var teacherDetail1="<div><span>"+data.lecturer+(data.ide_name==null ?"":data.ide_name)+"</span><img class='groupSchool' src='../images/groupschool_details_isjudge.png'></div><p class='organization'>"+(data.league_name==null?"":data.league_name)+"</p>";
								$(".teachIntro").html(teacherDetail1);
                                var courseDetail;
								/*课程须知*/
								var detailList=data.caption;
								var detailArr=detailList.split("，");
								for(i=0;i<detailArr.length;i++){
									courseDetail="<p class='xuzhiP size13 color999'>"+detailArr[i]+"</p>";
								}
								$("#corseXuZhi").html(courseDetail);
	                           if(hasPlus>-1){
	                           	 if(data.type==1){
	                           	 	/*视频课*/
	                           	 	var videoface=data.imgurl;
				       		  	  	if(videoface.indexOf("http")>-1){
				       		  	  		faceurl=videoface;
				       		  	  	}else{
				       		  	  		faceurl=imgUrl+videoface;
				       		  	  	}
		                             if(data.is_buy==0){
										if(data.fee==0){
											/*免费*/
											_t.freeMuLu(faceurl);
										}else{
											_t.directory();
											$(".videoBlock").prepend("<div class='video-slider';height: 8.747619rem;'></div>");
											if(data.imgurl.indexOf("http")<0){
												picUrl=imgUrl+data.imgurl;
											$(".videoBlock").prepend("<div class='video-slider' style='background-image:url("+(picUrl==null?"../images/banner1.png":picUrl)+");height: 8.747619rem;'><img src='../images/video-btn.png' /></div>");
											}else{
												$(".videoBlock").prepend("<div class='video-slider' style='background-image:url("+(data.imgurl==null?"../images/banner1.png":data.imgurl)+");height: 8.747619rem;'><img src='../images/video-btn.png' /></div>");

											}
											$(".video-slider").on('click',function(){
												 layer.open({
												    content: '尚未成功购买课程',
												    success:function(){
												    	$(".layui-m-layercont").css({"padding":"15px 15px","width":"auto"});
												    	$(".layui-m-layer0 .layui-m-layerchild").css("width","auto");
												    }
												  });
											});
											}
									}else if(data.is_buy==1){
										_t.freeMuLu(faceurl);
									}
	                           	 }else if(data.type==2){
	                           	 	_t.directory();
	                           	 }

                           }else{
                           	 if(data.imgurl.indexOf("http")<0){
										picUrl=imgUrl+data.imgurl;
										$(".videoBlock").prepend("<div class='video-slider' style='background-image:url("+(picUrl==null?"../images/banner1.png":picUrl)+");height: 8.747619rem;'><img  class='imgbtn' src='../images/video-btn.png' /></div>");
										}else{
											 $(".videoBlock").prepend("<div class='video-slider' style='background-image:url("+(data.imgurl==null?"../images/banner1.png":data.imgurl)+");height: 8.747619rem;'><img class='imgbtn' src='../images/video-btn.png' /></div>");
										}
                           		_t.directory();
	                           	var hideCon="<div class='hideVideo'><div>";
	                           	$("#vjs_video_3").before(hideCon);
	                           	$(".hideVideo,#vedioPrice,#jiGouCon,#pingLun,.video-slider,#MuluId").on('click',function(){
	                           		downLoad();
	                           	});
	                           	function downLoad(){
	                           		var u = navigator.userAgent, app = navigator.appVersion;
									var isAndroid = u.indexOf('Android') > -1 || u.indexOf('Linux') > -1; //android终端或者uc浏览器
									var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/); //ios终端

									if(isAndroid==1){
										//此处是安卓的留白
									window.location.href=andAppUrl;
									}else if(isiOS==1){
									window.location.href=iosAppUrl;
									}
									console.log("dd");
	                           }
                           }
                                _t.default();
                                /* 倒计时*/
                                /*倒计时*/
                               function FreshTime(id,times){
							        var endtime=new Date(times);
							        var nowtime = new Date();//当前时间
							        var lefttime=parseInt((endtime.getTime()-nowtime.getTime())/1000);
							        d=parseInt(lefttime/3600/24);
							        h=parseInt((lefttime/3600)%24);
							        m=parseInt((lefttime/60)%60);
							        s=parseInt(lefttime%60);
							        if(d < 10){
							         d = "0" + d;
							        }
							        if(h < 10){
							         h = "0" + h;
							        }
							        if(m < 10){
							         m = "0" + m;
							        }
							        if(s < 10){
							         s = "0" + s;
							        }

							        $(id).find(".date").text(d);
							        $(id).find(".hour").text(h);
							        $(id).find(".minutes").text(m);
							        $(id).find(".seconds").text(s);

							        if(lefttime<=0){
							            $(id).find(".date").text("00");
							            $(id).find(".hour").text("00");
							            $(id).find(".minutes").text("00");
							            $(id).find(".seconds").text("00");
							            clearInterval(sh);
							        }
							    }
							    var sh;
							    // 传id，日期时间
							    sh=setInterval(function(){
							        FreshTime("#times1","2017/06/30,20:00:00");
							        FreshTime("#times2","2018/06/18,23:59:59");
							    },1000);
                            }

                        });

                    },
                    /*免费目录*/
				freeMuLu:function(faceurl){
					var _t=this;
					var url=location.search;
					if(url.indexOf("?")!=-1)
					{
						function GetQueryString(name)
						{
						     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
						     var r = window.location.search.substr(1).match(reg);
						     if(r!=null)return  unescape(r[2]); return null;
						}
						GetQueryString("id");
						var idNum=GetQueryString("id");
						var userId=GetQueryString("user_id");
						var relaId=idNum;
						var uId=userId;
						var parm={"id":idNum,"user_id":userId};
						}
						else{
							var parm={"id":1,"user_id":1};
							var relaId=1;
							var uId=1;
						}
					$.ajax({
		              type: 'POST',
		              url: jieUrl+'206',
		              headers:{ut:tokenData},
		              data:parm,
		              dataType: 'json',
		              success: function(data) {
		              	var data=data.d;
			              	var list=[];
			              	for(i=0;i<data.length;i++){
			              		list[i]={"file":data[i].url,"image" : faceurl };
			              	}
			              	var thePlayer;
			              	 thePlayer = jwplayer('mediaplayer').setup({
					            playlist :list ,
					            width: "100%",
					            height: "8.747619rem",
					            dock: false,
					            events: {
					            	onPlay: function () {
					            		checkdirectory();
					            	}
					            }
					        });
			              	 if(data.length<=0){
			              		$("#MuluId").html("<p class='greyFont'>这些家伙都很懒，什么都没留下</p>");
			              	}else{
			              		var muLuCon = "<div>";
	                                   for (var i = 0; i < data[data.length - 1].chapter; i++) {
	                                    muLuCon += "<div class='webkBlo'><p class='videoBiao'>视频课</p><ul class='newMuLu webInp keCheng keChengMu'><li class='title' data-url='"+data[i].url+"'>第" + (i + 1) + "章";
	                                    $.each(data, function(key, value) {
	                                        if (value.chapter == i + 1) {
	                                            muLuCon += "</li><li>" + value.title + "</li><li class='newTitle'>"+value.caption+"</li>";
	                                        }
	                                    })
	                                    muLuCon += "</ul></div>";
	                                }
	                                muLuCon += "</div>";
			              	$("#MuluId").html(muLuCon);
			              	/*播放的时候验证目录*/
						       function checkdirectory(){
						       		var playadd=$(".jwvideo video").attr("src");
						       		var firstadd=list[0].sources[0].file;
//						       		if(playadd == firstadd){
//						       			$("#MuluId .webkBlo").eq(0).addClass("active");
//						       		}
						       }
			              	$("#MuluId .keCheng").each(function(index,element){
			              		$(this).on('click',function(){
				              		$(this).parents(".webkBlo").siblings().removeClass("active");
				              		$(this).parents(".webkBlo").addClass("active");
			              			jwplayer(0).playlistItem(index);
			              			var times = {"course_id":idNum};
			              			$.ajax({
						              type: 'POST',
						              url: jieUrl+'1030',
						              data:times,
						              headers:{ut:tokenData},
						              dataType: 'json',
						              success: function(data) {
//						              	console.log(data)
						              }
						              });
			              		})
			              	})
			              	}
		              },
		              error: function(xhr, type) {
		                console.info("服务器出错");
		              }
		            })
				},
                    /*加载目录*/
                    directory: function() {
                        var _t = this;
                       	//通过链接获取id
        				var url=location.search;
						if(url.indexOf("?")!=-1)
						{
							function GetQueryString(name)
							{
							     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
							     var r = window.location.search.substr(1).match(reg);
							     if(r!=null)return  unescape(r[2]); return null;
							}
							GetQueryString("id");
							var idNum=GetQueryString("id");
							var userId=GetQueryString("user_id");
							var relaId=idNum;
							var uId=userId;
							var parm={"id":idNum,"user_id":userId};
							}
							else{
								var parm={"id":1,"user_id":1};
								var relaId=1;
								var uId=1;
							}
                        $.ajax({
                            type: 'POST',
                            url: jieUrl+'206',
                            data: parm,
                            headers:{ut:tokenData},
                            dataType: 'json',
                            success: function(data) {
                            	if(data.d.length==0){
				              		$("#MuluId").html("<p class='greyFont'>暂无课程目录</p>");
				              	}else{
				              		var muLuCon = "<div>";
	                                for (var i = 0; i < data.d[data.d.length - 1].chapter; i++) {
	                                    muLuCon += "<ul class='keCheng keChengMu'><span class='greyPoint'></span><li class='title'>第" + (i + 1) + "章";
	                                    $.each(data.d,
	                                    function(key, value) {
	                                        if (value.chapter == i + 1) {
	                                            muLuCon += "</li>" + "<li><a  data-id='" + data.d[i].url + "'  data-courseId='" + data.d[i].chapter + "'>"+ value.title +"</a></li>";
											}
										})

	                                    muLuCon += "</ul>";
	                                }
	                                muLuCon += "</div>";
	                                $("#MuluId").html(muLuCon);
				              	}
							var videoList;
                            if(hasPlus>-1){
								if(isAndroid==1){
									videoList="<video id='my_video' style='height: 100%'><source  controls='controls' ></video><div class='controller' id='controller'><div class='start icon'> &#xe672;</div> <div class='progress'><div class='inner'></div></div><div class='fullscreen icon' id='fullScreenBtn'>&#xe643;</div></div>";
								}else if(isiOS==1){
										videoList="<video id='my_video' style='height: 100%' ><source  controls='controls' webkit-playsinline=''></video><div class='controller' id='controller'><div class='start icon'> &#xe672;</div> <div class='progress'><div class='inner'></div></div><div class='fullscreen icon' id='fullScreenBtn'>&#xe643;</div></div>";
								}
								$(".imgbtn").on('click',function() {
									var first=$(".keCheng li").eq(1).children("a").attr("data-id");
									$(this).parent().css("display","none");
									$(this).parent().next().html(videoList).children("video").children("source").attr("src",first);})
								$('.keCheng li').on('click', function() {
									var srcName = $(this).children("a").attr("data-id");
									$("#mediaplayer").html(videoList).children("video").children("source").attr("src", srcName);
									$(".video-slider").css("display", "none");
								})
								$('.keCheng .title').on('click', function () {
									var srcName = $(this).siblings("li").children("a").attr("data-id");
									$("#mediaplayer").html(videoList).children("video").children("source").attr("src", srcName);
									$(".video-slider").css("display", "none");
								})
							}else{
								videoList="<video id='my_video'><source></video><div class='controller' id='controller'><div class='start icon'> &#xe672;</div> <div class='progress'><div class='inner'></div></div><div class='fullscreen icon' id='fullScreenBtn'>&#xe643;</div></div>";
								//反射調用
								var invokeFieldOrMethod = function(element, method)
								{
									var usablePrefixMethod;
									["webkit", "moz", "ms", "o", ""].forEach(function(prefix) {
										if (usablePrefixMethod) return;
										if (prefix === "") {
											// 无前缀，方法首字母小写
											method = method.slice(0,1).toLowerCase() + method.slice(1);
										}
										var typePrefixMethod = typeof element[prefix + method];
										if (typePrefixMethod + "" !== "undefined") {
											if (typePrefixMethod === "function") {
												usablePrefixMethod = element[prefix + method]();
											} else {
												usablePrefixMethod = element[prefix + method];
											}
										}
									});

									return usablePrefixMethod;
								};
								//进入全屏
								function launchFullscreen(element)
								{
									//此方法不可以在異步任務中執行，否則火狐無法全屏
									if(element.requestFullscreen) {
										element.requestFullscreen();
									} else if(element.mozRequestFullScreen) {
										element.mozRequestFullScreen();
									} else if(element.msRequestFullscreen){
										element.msRequestFullscreen();
									} else if(element.oRequestFullscreen){
										element.oRequestFullscreen();
									}
									else if(element.webkitRequestFullscreen)
									{
										element.webkitRequestFullScreen();
									}else{

										var docHtml  = document.documentElement;
										var docBody  = document.body;
										var videobox  = $("#my_video")[0];
										var  cssText = 'width:100%;height:100%;overflow:hidden;';
										docHtml.style.cssText = cssText;
										docBody.style.cssText = cssText;
										videobox.style.cssText = cssText+';'+'margin:0px;padding:0px;';
										document.IsFullScreen = true;

									}
								}
								//退出全屏
								function exitFullscreen()
								{
									if (document.exitFullscreen) {
										document.exitFullscreen();
									} else if (document.msExitFullscreen) {
										document.msExitFullscreen();
									} else if (document.mozCancelFullScreen) {
										document.mozCancelFullScreen();
									} else if(document.oRequestFullscreen){
										document.oCancelFullScreen();
									}else if (document.webkitExitFullscreen){
										document.webkitExitFullscreen();
									}else{
										var docHtml  = document.documentElement;
										var docBody  = document.body;
										var videobox  = $("#my_video")[0];
										docHtml.style.cssText = "";
										docBody.style.cssText = "";
										videobox.style.cssText = "";
										document.IsFullScreen = false;
									}
								}
								$(".imgbtn").on('click',function() {
									var first=$(".keCheng li").eq(1).children("a").attr("data-id");
									$(this).parent().css("display","none");
									$(this).parent().next().html(videoList).children("video").children("source").attr("src",first);

									var startbtn=$(".start.icon").eq(0);
									$("#my_video")[0].play()
									var startflag=true;
									startbtn.on('click',function () {//开始暂停
										if(startflag){
											$("#my_video")[0].pause()
											startbtn.html("&#xe609;");
										}else{
											$("#my_video")[0].play();
											startbtn.html("&#xe672;");
										}
										startflag=!startflag;
									})
									var duration=0;
									var now=0;
									$("#my_video")[0].oncanplay=function () {//能够播放时
										duration=$("#my_video")[0].duration;//总时长
									}
									$("#my_video")[0].ontimeupdate=function () {
										now=$("#my_video")[0].currentTime;//当前时长
										var width=now/duration;//时长转换为长度
										$(".inner").css("width",width*100+"%");
									}
//								//滚动条
//								var progress=$(".progress");
//								var video=$("#my_video")[0];
//								var l=progress.width();
//								progress.delegate('.inner','touchstart',function(e){
//									console.log(e)
//									var ox=$(".inner").screenX;
//									var bili=ox/l;
//									var pos=duration*bili;
//									video.currentTime=pos;
//									progress.delegate('.inner','touchmove',function(e){
//										var ox=e.clientX-progress.offsetLeft;
//										var bili=ox/l;
//										var pos=duration*bili;
//										video.currentTime=pos;
//									})
//									document.addEventListener('touchend',function(){
//										document.onmousedown=null;
//										document.onmouseup=null;
//									},false)
//								})
									document.getElementById('fullScreenBtn').addEventListener('click', function () {
										launchFullscreen(document.getElementById('my_video'));
									}, false);
									setTimeout(function(){$("#controller").css("opacity","0");},4000);
									$("#my_video").on('click',function(){
										$("#controller").css("opacity","1");
										setTimeout(function(){$("#controller").css("opacity","0");},4000);
									});
								})
								$('.keCheng li').on('click', function() {
									var srcName = $(this).children("a").attr("data-id");
									$("#mediaplayer").html(videoList).children("video").children("source").attr("src", srcName);
									$(".video-slider").css("display", "none");
									var startbtn = $(".start.icon").eq(0);
									$("#my_video").get(0).play();
									var startflag = true;
									startbtn.on('click', function () {//开始暂停
										if(startflag){
											$("#my_video")[0].pause()
											startbtn.html("&#xe609;");
										}else{
											$("#my_video")[0].play();
											startbtn.html("&#xe672;");
										}
										startflag = !startflag;
									})
									var duration = 0;
									var now = 0;
									$("#my_video")[0].oncanplay = function () {//能够播放时
										duration = $("#my_video")[0].duration;//总时长
									}
									$("#my_video")[0].ontimeupdate = function () {
										now = $("#my_video")[0].currentTime;//当前时长
										var width = now / duration;//时长转换为长度
										$(".inner").css("width", width * 100 + "%");
									}
									document.getElementById('fullScreenBtn').addEventListener('click', function () {
										launchFullscreen(document.getElementById('my_video'));
									}, false);
									setTimeout(function(){$("#controller").css("opacity","0");},4000);
									$("#my_video").on('click',function(){
										$("#controller").css("opacity","1");
										setTimeout(function(){$("#controller").css("opacity","0");},4000);
									})
								})
								$('.keCheng .title').on('click', function () {
									var srcName = $(this).siblings("li").children("a").attr("data-id");
									$("#mediaplayer").html(videoList).children("video").children("source").attr("src", srcName);
									$(".video-slider").css("display", "none");
									$("#my_video")[0].play();
									var startbtn = $(".start.icon").eq(0);
									$("#my_video").get(0).play();
									var startflag = true;
									startbtn.on('click', function () {//开始暂停
										if(startflag){
											$("#my_video")[0].pause()
											startbtn.html("&#xe609;");
										}else{
											$("#my_video")[0].play();
											startbtn.html("&#xe672;");
										}
										startflag = !startflag;
									})
									var duration = 0;
									var now = 0;
									$("#my_video")[0].oncanplay = function () {//能够播放时
										duration = $("#my_video")[0].duration;//总时长
									}
									$("#my_video")[0].ontimeupdate = function () {
										now = $("#my_video")[0].currentTime;//当前时长
										var width = now / duration;//时长转换为长度
										$(".inner").css("width", width * 100 + "%");
									}
									document.getElementById('fullScreenBtn').addEventListener('click', function () {
										launchFullscreen(document.getElementById('my_video'));
									}, false);
									setTimeout(function(){$("#controller").css("opacity","0");},4000);
									$("#my_video").on('click',function(){
										$("#controller").css("opacity","1");
										setTimeout(function(){$("#controller").css("opacity","0");},4000);
									})
								})
							}
						},
                            error: function(xhr, type) {
                                console.info("服务器出错");
                            }
                        })
                    },
                      /*加载评价*/
					evaluation:function(){
						var _t=this;
						 //通过链接获取id
        				var url=location.search; 
						if(url.indexOf("?")!=-1) 
						{
							function GetQueryString(name)
							{
							     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
							     var r = window.location.search.substr(1).match(reg);
							     if(r!=null)return  unescape(r[2]); return null;
							}
							GetQueryString("id");
							var idNum=GetQueryString("id");
							var userId=GetQueryString("user_id");
							var parm={"id":idNum,"user_id":userId,"page":1,"page_size":15};
							}
							else{
								var parm={"id":1,"user_id":1,"page":1,"page_size":15};
								var idNum=1;
							}
						$.ajax({
			              type: 'POST',
			              url: jieUrl+'208',
			              data:parm,
			              headers:{ut:tokenData},
			              dataType: 'json',
			              success: function(data) {
			              	var data=data.d;
			              	var pingCon="";
			              	if(data.list.length<1){
			              		$("#pingLun").append("<p class='greyFont'>暂无评价记录</p>");
			              	}else{
			              		for(i=0;i<data.list.length;i++){
			              		pingCon+="<div class='webkBlo marBottom10'><p class='pingPer marRight9'><img src='"+data.list[i].avatar+"' /></p>"+
										"<div class='webInp'><div class='greyFont size12 marBottom7 overHide'>"+data.list[i].nickname+"<div class='starCore'><div class='atar_Show'><p tip='"+data.list[i].star+"'></p></div></div></div><p class='pingCon'>"+data.list[i].content+"</p></div></div>";
								
			              		}  
							    $("#pingLun").append(pingCon);
			              	}
							    //综合评分
							    $("#score").html(data.complex);
							     $(".starCore p").each(function(index, element) {
								        var num=$(this).attr("tip");
								        var www=num*16;//
								        $(this).css("width",www);
								        //$(this).parent(".atar_Show").siblings("span").text(num+"分");
								});
						 _t.default();
			              },
			              error: function(xhr, type) {
			                console.info("服务器出错");
			              }
			            })
					},
					/*加载失败*/
					default:function(){
						var _t=this;
						$('img').error(function(){
								$(this).attr("src","../images/default.png");
							});
					}

                }
                $(function() {
                    g.init();
                });
            })($);
        </script>
        <script type="text/javascript">
			
		var myScroll,
			pullDownEl, pullDownOffset,
			pullUpEl, pullUpOffset,
			generatedCount = 0;
		var page=2;
		 function AjaxLoad() {
		 	//通过链接获取id
        	var url=location.search; 
			if(url.indexOf("?")!=-1) 
			{
				function GetQueryString(name)
				{
				     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
				     var r = window.location.search.substr(1).match(reg);
				     if(r!=null)return  unescape(r[2]); return null;
				}
				GetQueryString("id");
				var idNum=GetQueryString("id");
				var userId=GetQueryString("user_id");
				var parm={"id":idNum,"user_id":userId,"page":page++,"page_size":15};
				}
				else{
					var parm={"id":1,"user_id":1,"page":page++,"page_size":15};
					var idNum=1;
				}
		$.ajax({
          type: 'POST',
          url: jieUrl+'208',
          data:parm,
          headers:{ut:tokenData},
          dataType: 'json',
          success: function(data) {
          	var data=data.d;
          	var pingCon="";
          	for(i=0;i<data.list.length;i++){
              		pingCon+="<div class='webkBlo marBottom10'><p class='pingPer marRight9'><img src='"+data.list[i].avatar+"' /></p>"+
				"<div class='webInp'><div class='greyFont size12 marBottom7 overHide'>"+data.list[i].nickname+"<div class='starCore'><div class='atar_Show'><p tip='"+data.list[i].star+"'></p></div></div></div><p class='pingCon'>"+data.list[i].content+"</p></div></div>";
				  
              }  
			    $("#pingLun").append(pingCon);
			     $(".starCore p").each(function(index, element) {
			        var num=$(this).attr("tip");
			        var www=num*16;//
			        $(this).css("width",www);
			        //$(this).parent(".atar_Show").siblings("span").text(num+"分");
			    });
			    $('img').error(function(){
					$(this).attr("src","../images/default.png");
				});
          },
          error: function(xhr, type) {
            console.info("服务器出错");
          }
      });
      
		myScroll.refresh();		
		}
		function pullDownAction () {
			setTimeout(function () {
		       if(hasPlus>-1){
		       	AjaxLoad();
		       	console.log("里面");
		       }else{
					if(isAndroid==1){
					window.location.href=andAppUrl;
					}else if(isiOS==1){
					window.location.href=iosAppUrl;
					}
		       }
				 setTimeout(function(){
				 	myScroll.refresh();	
				 }, 1000);
			}, 1000);
		}
		
		function pullUpAction () {
		setTimeout(function () {
		       if(hasPlus>-1){
			       	AjaxLoad();
			       	console.log("里面");
		       }else{
					if(isAndroid==1){
					window.location.href=andAppUrl;
					}else if(isiOS==1){
					window.location.href=iosAppUrl;
					}
		       }
			setTimeout(function(){
				 	myScroll.refresh();	
				 }, 1000);	
		}, 1000);	
	}
		/**
		 * 初始化iScroll控件
		 */
		function loaded() {
		pullDownEl = document.getElementById('pullDown');
		pullDownOffset = pullDownEl.offsetHeight;
		pullUpEl = document.getElementById('pullUp');	
		pullUpOffset = pullUpEl.offsetHeight;
		
		myScroll = new iScroll('wrapper', {
			scrollbarClass: 'myScrollbar', /* 重要样式 */
			useTransition: false, /* 此属性不知用意，本人从true改为false */
			topOffset: pullDownOffset,
			onRefresh: function () {
				if (pullDownEl.className.match('loading')) {
					pullDownEl.className = '';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
				} else if (pullUpEl.className.match('loading')) {
					pullUpEl.className = '';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
				}
			},
			onScrollMove: function () {
				if (this.y > 5 && !pullDownEl.className.match('flip')) {
					pullDownEl.className = 'flip';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '松手开始更新...';
					this.minScrollY = 0;
				} else if (this.y < 5 && pullDownEl.className.match('flip')) {
					pullDownEl.className = '';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
					this.minScrollY = -pullDownOffset;
				} else if (this.y < (this.maxScrollY - 5) && !pullUpEl.className.match('flip')) {
					pullUpEl.className = 'flip';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '松手开始更新...';
					this.maxScrollY = this.maxScrollY;
				} else if (this.y > (this.maxScrollY + 5) && pullUpEl.className.match('flip')) {
					pullUpEl.className = '';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
					this.maxScrollY = pullUpOffset;
				}
			},
			onScrollEnd: function () {
				if (pullDownEl.className.match('flip')) {
					pullDownEl.className = 'loading';
					pullDownEl.querySelector('.pullDownLabel').innerHTML = '加载中...';				
					pullDownAction();	// Execute custom function (ajax call?)
				} else if (pullUpEl.className.match('flip')) {
					pullUpEl.className = 'loading';
					pullUpEl.querySelector('.pullUpLabel').innerHTML = '加载中...';				
					pullUpAction();	// Execute custom function (ajax call?)
				}
			}
		});
		
		setTimeout(function () { document.getElementById('wrapper').style.left = '0'; }, 800);
	}			
	//初始化绑定iScroll控件 
	//document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
	document.addEventListener('DOMContentLoaded', loaded, false); 
			
			</script>
    </body>

</html>