<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta content="telephone=no" name="format-detection">
    <meta name="wap-font-scale" content="no">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>教师详情</title>
    <link href="../css/index.css?+Math.random()" rel="stylesheet">
    <link href="../css/scrollbar.css" rel="stylesheet">
    
    <body class="marginNone padBottom20 theBody">
      <div class="teaHeader">
       	<img src="../images/laobg.png" class="laoBg"/>
       	<div class="teaTou">
       		<img id="teaImg" class="teaIcon"/>
       		<span class="teaName" id="teaName"></span>
       	</div>
       	<ul class="teaJie">
       		<li><img src="../images/laoLing.png/">
       		<span id="jiaoLing"></span>
       		</li>
       		<li><img src="../images/laoTea.png">
       		<span id="position"></span>
       		</li>
       	</ul>
       </div>
      <div class="mainContent actBlo padLeftRight">
      
       <ul class="keShiUl borBottom" id="feeMode">
       </ul>
       <p class="title color2C size13 padTop20 marBottom10">老师简介</p>
            <p class="size12 color999 hasBig">毕业学校：<span id="schole"></span></p>
            <p class="size12 color999 hasBig posRelite">上课地址：<span class="width50P" id="adress"></span></p>
            <!--<div class="webkBlo marTop4" id="biaoQian" style="">
            	<span class="size12 color999">老师标签：</span>
            	
            </div>-->
        <p class="color8d size13 padTop20 marBottom7">自我介绍</p>
            <p class="size12 color999 selfCon" id="descript"></p>
      </div>
       <ul class="tabUl padLeftRight borBottom">
      <li class="active">
        <span>课程</span></li>
      <li>
        <span>相册</span></li>
      <li>
        <span>评价</span></li>
    </ul>
    <div class="tabBlock">
      <div class="tabContent borBottom">
        <div class="tabCon padLeftRight">
          <p class="title color2C outLine">课程提纲</p>
          <div id="MuluId">
          	<!--目录-->
          </div>
          <p class="seeMore">查看更多课程</p>
        </div>
        <div class="tabCon disNone">
          <div class="padLeftRight padBottom20">
          	<ul class="xiangUl" id="album">
          		<li>
          			<img src="../images/laoCe.png" />
          		</li>
          		<li>
          			<img src="../images/laoCe.png" />
          		</li>
          		<li>
          			<img src="../images/laoCe.png" />
          		</li>
          		<li>
          			<img src="../images/laoCe.png" />
          		</li>
          		<li>
          			<img src="../images/laoCe.png" />
          		</li>
          		<li>
          			<img src="../images/laoCe.png" />
          		</li>
          	</ul>
        </div>
        </div>
        <div class="tabCon disNone padLeftRight">
                    	<p class="title color2C size13 padTop20 marBottom10">
           					<span class="greyFont size12">综合评分</span><span id="score"></span>
                    	</p>
                    	<div class="lunRelative">
							<div id="wrapper">
							<div id="scroller" >
								<div id="pullDown" style="overflow: hidden;">
									<span class="pullDownIcon"></span><span class="pullDownLabel">下拉刷新...</span>
								</div>
								<div id="pingLun"></div>
								<div id="pullUp" class="pullUp" style="overflow: hidden;">
									<span class="pullUpIcon"></span><span class="pullUpLabel"></span>
								</div>
							</div>
							</div>
						</div>
                   
                </div>
      </div>
      <ul class="baoZhUl">
      	<li>
      		<img src="../images/liaoAn1.png" />
      		资金安全
      	</li>
      	<li>
      		<img src="../images/liaoAn2.png" />
      		随时可退
      	</li>
      	<li>
      		<img src="../images/liaoAn3.png" />
      		真实评价
      	</li>
      	<li>
      		<img src="../images/liaoAn4.png" />
      		实名认证
      	</li>
      </ul>
    </div>
    <div class="liaoAnBlo"></div>
    <script src="../js/zepto.min.js"></script>
    <script src="../js/iscroll.js"></script>
		<script src="../js/iscroll4.2.5.js"></script>
		<script src="../js/startScore.js"></script>
		<script src="../js/common.js"></script>
      <script>!(function($) {
        var g = {
          init: function() {
            var _t = this;
            //调用tab
            _t.tab();
            /*老师详情*/
           _t.teaDetail();
	          /*评价*/
	         _t.evaluation();
	         /*加载图片*/
	        _t.default();
	        /*课程提纲*/
	       _t.syllabus();
          },
          //调用tab
          tab: function() {
            var _t = this;
            $(".tabUl li").each(function(index, element) {
              var i = index;
              $(this).on('click',
              function() {
                $(".tabUl li").removeClass("active");
                $(this).addClass("active");
                $(".tabContent .tabCon").hide();
                $(".tabContent .tabCon").eq(i).show();

              });
            });
          },
          /*老师详情*/
         teaDetail:function(){
         	var _t=this;
        	 //通过链接获取id
            var url=location.search; 
						if(url.indexOf("?")!=-1) 
						{
							function GetQueryString(name)
							{
							     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
							     var r = window.location.search.substr(1).match(reg);
							     if(r!=null)return  unescape(r[2]); return null;
							}
							GetQueryString("id");
							var idNum=GetQueryString("id");
							var userId=GetQueryString("user_id");
							var relaId=idNum;
							var uId=userId;
							var parm={"id":idNum,"user_id":userId};
							}
							else{
								var parm={"id":1,"user_id":1};
								var relaId=1;
								var uId=1;
							}
                $.ajax({
                    type: 'POST',
                    url: jieUrl+'271',
                    data: parm,
                    headers:{ut:tokenData},
                    dataType: 'json',
                    success: function(data) {
                    	var data=data.d;
                    	$("#teaName").html(data.nickname);
                    	$("#jiaoLing").html(data.teach_age+"年教龄");
                    	$("#position").html(data.position);
                    	$("#schole").html(data.university==null?"该老师很懒，什么也没留下":data.university);
                    	$("#teaImg").attr("src",data.img_url);
                    	$("#adress").html(data.address==null?"该老师很懒，什么也没留下":data.address);
                    	if(data.specialty==null){
                    	}else{
		                    	var spanCon=data.specialty;
		                    	var spanlist=spanCon.split("，");
		                    	var spanHtml="";
		                    	for(i=0;i<spanlist.length;i++){
		                    		spanHtml+="<span class='greyborSpan marRight2'>"+spanlist[i]+"</span>";
		                    	}
                    	};
                    	$("#descript").html((data.introduce==null?"这位老师好懒，什么都没留下~~":data.introduce));
                    	if(data.album_url==null){
                    		$("#album").html("<p class='greyFont padLeftRight marTop10'>暂无相册</p>");
                    	}else{
                    		var album=(data.album_url).split(",");
	                    	var albumCon="";
	                    	for(i=0;i<album.length;i++){
	                    		if(album[i].indexOf("http")<0){
	                    		albumCon+="<li style='background-image:url("+imgUrl+album[i]+")'></li>";
	                    		}else{
	                    			albumCon+="<li style='background-image:url("+album[i]+")'></li>";
	                    		}
	                    	}
	                    	$("#album").html(albumCon);
                    	}
                    	if(data.mode.length>0){
                    		$("#feeMode").show()
                    		var feeMode="";
	                    	for(i=0;i<data.mode.length;i++){
	                    		feeMode+="<li>"+data.mode[i].fee_price+"元/"+(data.mode[i].fee_unit==1?"小时":"天")+"<span class='greyFont greyborSpan marLeft9'>"+(data.mode[i].teach_mode==1?"一对一":"一对多")+"</span></li>";
	                    	}
	                    	$("#feeMode").html(feeMode);
                    	}else{
                    		$("#feeMode").hide();
                    	}
                    	
                    	_t.default();
                    }
                 });
         },
            /*加载评价*/
					evaluation:function(){
						var _t=this;
						 //通过链接获取id
        			var url=location.search; 
						if(url.indexOf("?")!=-1) 
						{
							function GetQueryString(name)
							{
							     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
							     var r = window.location.search.substr(1).match(reg);
							     if(r!=null)return  unescape(r[2]); return null;
							}
							GetQueryString("id");
							var idNum=GetQueryString("id");
							var userId=GetQueryString("user_id");
							var relaId=idNum;
							var uId=userId;
							var parm={"id":idNum,"teacher_id":userId,"page":1,"page_size":15};
							}
							else{
								var parm={"id":1,"teacher_id":1,"page":1,"page_size":15};
								var relaId=1;
								var uId=1;
							}
						$.ajax({
			              type: 'POST',
			              url: jieUrl+'244',
			              data:parm,
			              headers:{ut:tokenData},
			              dataType: 'json',
			              success: function(data) {
			              	var data=data.d;
			              	var pingCon="";
			              	if(data==""){
			              	}else{
			              		if(data.list.length<=0){
				              		$("#pingLun").html("<p class='greyFont'>暂无评价记录</p>");
				              	}else{
				              		for(i=0;i<data.list.length;i++){
						              		pingCon+="<div class='webkBlo marBottom10'><p class='pingPer marRight9'><img src='"+data.list[i].avatar+"' /></p>"+
															"<div class='webInp'><div class='greyFont size12 marBottom7 overHide'>"+data.list[i].nickname+"<div class='starCore'><div class='atar_Show'><p tip='"+data.list[i].star+"'></p></div>";
										    			pingCon+="</div></div><p class='pingCon'>"+data.list[i].content+"</p></div></div>";
						             	} 
										    	$("#pingLun").append(pingCon);
				              	}
			              	}
			              	
										     $(".starCore p").each(function(index, element) {
										        var num=$(this).attr("tip");
										        var www=num*2*16;//
										        $(this).css("width",www);
										        //$(this).parent(".atar_Show").siblings("span").text(num+"分");
										    });
										    //综合评分
										    $("#score").html(data.complex);
										    _t.default();
			              },
			              error: function(xhr, type) {
			                console.info("服务器出错");
			              }
			            })
					},
					/*图片加载*/
					default:function(){
						var_t=this;
						$('img').error(function(){
							$(this).attr("src","../images/default.png");
						});
					},
					/*课程提纲*/
					syllabus:function(){
						var _t=this;
							var url=location.search; 
						if(url.indexOf("?")!=-1) 
						{
							function GetQueryString(name)
							{
							     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
							     var r = window.location.search.substr(1).match(reg);
							     if(r!=null)return  unescape(r[2]); return null;
							}
							GetQueryString("id");
							var idNum=GetQueryString("id");
							var userId=GetQueryString("user_id");
							var relaId=idNum;
							var uId=userId;
							var parm={"id":userId,"teacher_id":idNum,"page":1,"page_size":4};
							}
							else{
								var parm={"id":1,"teacher_id":1,"page":1,"page_size":4};
								var relaId=1;
								var uId=1;
							}
						$.ajax({
			              type: 'POST',
			              url: jieUrl+'470',
			              data:parm,
			              headers:{ut:tokenData},
			              dataType: 'json',
			              success: function(data) {
			              	var data=data.d;
			              	if(data.length>0){
			              		var con="<div class='video-block'>";
			              		for(i=0;i<data.length;i++){
			              			if(data[i].imgurl==null){
			              				data[i].imgurl="../images/default.png";
			              			}else{
			              				if(data[i].imgurl.indexOf("http")<0){
					              			data[i].imgurl=imgUrl+data[i].imgurl;
					              		}
			              			}
			              		 con+="<div class='course-wrapper'><div class='conten-out' data-kill='"+data[i].is_kill+"' data-id='"+data[i].id+"' data-course='"+data[i].course_type+"' data-type='"+data[i].type+"'><img class='index-img' src='../images/onVideo.png' /><img class='starVideo' src='../images/onVideoStart.png'/><img src='"+data[i].imgurl+"' /></div><p class='tea-course-tit'>"+data[i].title+"</p></div>";
			              		}
			              		if(data.length==4){
			              		con+="</div>";
			              		$(".seeMore").show();
			              		}else  if(data.length<4){
			              			con+="</div>";
			              		}
			              		$("#MuluId").html(con);
			              		_t.default();
			              	}else{
			              		$("#MuluId").html("<p class='greyFont marBottom10 padBottom10'>暂无课程记录</p>");
			              		$(".seeMore").hide();
			              	}
			              	var page=0;
			              	$(".seeMore").on('click',function(){
			              		page++;
			              		_t.loadMore(page,idNum,userId);
			              	});
			              	/*点击跳转视频页面*/
			              	$(".course-wrapper>.conten-out").each(function(index,element){
			              		$(this).on('click',function(){
			              			var videoType=$(this).attr("data-course");
			              			var lineType=$(this).attr("data-type");
			              			var kill=$(this).attr("data-kill");
			              			/*全课程*/
			              			if(videoType==1){
			              				/*秒杀课*/
			              				console.log("秒杀课吗")
			              				if(kill==1){
			              						if(lineType==1){
					              					/*视频课*/
					              					console.log("第咦种啊第二种")
						              					window.location.href=pageUrl+'msg/207m.html?id='+relaId+"&"+"user_id="+uId;
						              				}else{
						              					console.log("第二种啊第二种")
						              					window.location.href=pageUrl+'msg/207m-2.html?id='+relaId+"&"+"user_id="+uId;
						              				}
			              				}else if(kill==0){
			              						if(lineType==1){
					              					/*视频课*/
					              					window.location.href=pageUrl+'msg/207.html?id='+relaId+"&"+"user_id="+uId;
					              				}else{
					              					window.location.href=pageUrl+'msg/207-2.html?id='+relaId+"&"+"user_id="+uId;
					              				}
			              				}
			              			}else if(videoType==2){
			              				/*直播课*/
			              				window.location.href=pageUrl+'msg/222.html?id='+relaId+"&"+"user_id="+uId;
			              			}
			              			else if(videoType==3){
			              				/*分期返*/
			              				if(lineType==1){
			              					/*视频课*/
			              				window.location.href=pageUrl+'msg/232.html?id='+relaId+"&"+"user_id="+uId;
			              				}else{
			              				window.location.href=pageUrl+'msg/232-2.html?id='+relaId+"&"+"user_id="+uId;
			              				}
			              			}else if(videoType==4){
			              				/*一元课*/
			              				if(lineType==1){
			              				window.location.href=pageUrl+'msg/241.html?id='+relaId+"&"+"user_id="+uId;
			              				}else{
			              				window.location.href=pageUrl+'msg/241-2.html?id='+relaId+"&"+"user_id="+uId;
			              				}

			              			}
		                       	if(isAndroid==1){
																//此处是安卓
																//window.android.onMoreClick();
															}else if(isiOS==1){
									        		  //window.webkit.messageHandlers.Share.postMessage({});
															}
			              		});
			              	});
			              	_t.default();
			              	
			              },
			              error: function(xhr, type) {
			                console.info("服务器出错");
			              }
			            })
					},
					 /*查看更多*/
             loadMore:function(page,idNum,userId){
             	var _t=this;
             	var parm={"id":idNum,"teacher_id":userId,"page":page++,"page_size":4};
             		$.ajax({
			              type: 'POST',
			              url: jieUrl+'470',
			              data:parm,
			              headers:{ut:tokenData},
			              dataType: 'json',
			              success: function(data) {
			              	var data=data.d;
			              		var con="<div class='video-block'>";
			              		for(i=0;i<data.length;i++){
			              				if(data[i].imgurl.indexOf("http")<0){
					              			data[i].imgurl=imgUrl+data[i].imgurl;
					              		}
			              		 con+="<div class='course-wrapper'><div class='conten-out'><img class='index-img' src='../images/onVideo.png' /><img class='starVideo' src='../images/onVideoStart.png'/><img src='"+data[i].imgurl+"' data-id='"+data[i].id+"' data-course='"+data[i].course_type+"' data-type='"+data[i].type+"'/></div><p class='tea-course-tit'>"+data[i].title+"</p></div>";
			              		}
			              		if(data.length==4){
			              		con+="</div>";
			              		}else  if(data.length<4){
			              			con+="</div><p class='seeMore'>没有更多课程了</p>";
			              			$(".seeMore").hide();
			              		}
			              		$("#MuluId").append(con);
			              		$(".conten-out").each(function(index,element){
			              		$(this).on('click',function(){
			              			var videoType=$(this).attr("data-course");
			              			var lineType=$(this).attr("data-type");
			              			var kill=data-kill;
			              			/*全课程*/
			              			if(videoType==1){
			              				/*秒杀课*/
			              				if(kill==1){
			              						if(lineType==1){
					              					/*视频课*/
						              					window.location.href=pageUrl+'msg/207m.html?id='+relaId+"&"+"user_id="+uId;
						              				}else{
						              					window.location.href=pageUrl+'msg/207m-2.html?id='+relaId+"&"+"user_id="+uId;
						              				}
			              				}else if(kill==0){
			              						if(lineType==1){
					              					/*视频课*/
					              					window.location.href=pageUrl+'msg/207.html?id='+relaId+"&"+"user_id="+uId;
					              				}else{
					              					window.location.href=pageUrl+'msg/207-2.html?id='+relaId+"&"+"user_id="+uId;
					              				}
			              				}
			              			}else if(videoType==2){
			              				/*直播课*/
			              				window.location.href=pageUrl+'msg/222.html?id='+relaId+"&"+"user_id="+uId;
			              			}
			              			else if(videoType==3){
			              				/*分期返*/
			              				if(lineType==1){
			              					/*视频课*/
			              				window.location.href=pageUrl+'msg/232.html?id='+relaId+"&"+"user_id="+uId;
			              				}else{
			              				window.location.href=pageUrl+'msg/232-2.html?id='+relaId+"&"+"user_id="+uId;
			              				}
			              			}else if(videoType==4){
			              				/*一元课*/
			              				if(lineType==1){
			              				window.location.href=pageUrl+'msg/241.html?id='+relaId+"&"+"user_id="+uId;
			              				}else{
			              				window.location.href=pageUrl+'msg/241-2.html?id='+relaId+"&"+"user_id="+uId;
			              				}

			              			}
		                       	if(isAndroid==1){
																//此处是安卓
																//window.android.onMoreClick();
															}else if(isiOS==1){
									        		 // window.webkit.messageHandlers.Share.postMessage({});
															}
			              		});
			              	});
			              		_t.default();
			              }
			              });
             }
        }
        $(function() {
          g.init();
        });
      })($);</script>
       <script type="text/javascript">
						var myScroll,
								pullDownEl, pullDownOffset,
								pullUpEl, pullUpOffset,
								generatedCount = 0;
						var page=1;
						 function AjaxLoad() {
						 	//通过链接获取id
					        	var url=location.search; 
									if(url.indexOf("?")!=-1) 
									{
										function GetQueryString(name)
										{
										     var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
										     var r = window.location.search.substr(1).match(reg);
										     if(r!=null)return  unescape(r[2]); return null;
										}
										GetQueryString("id");
										var idNum=GetQueryString("id");
										var userId=GetQueryString("user_id");
										var relaId=idNum;
										var uId=userId;
										var parm={"id":idNum,"teacher_id":userId,"page":page++,"page_size":15};
										}
										else{
											var parm={"id":1,"teacher_id":1,"page":page++,"page_size":15};
											var relaId=1;
											var uId=1;
										}
								$.ajax({
					              type: 'POST',
					              url: jieUrl+'244',
					              data:parm,
					              headers:{ut:tokenData},
					              dataType: 'json',
					              success: function(data) {
					              	var data=data.d;
					              	var pingCon="";
					              		for(i=0;i<data.list.length;i++){
					              			pingCon+="<div class='webkBlo marBottom10'><p class='pingPer marRight9'><img src='"+data.list[i].avatar+"' /></p>"+
															"<div class='webInp'><div class='greyFont size12 marBottom7 overHide'>"+data.list[i].nickname+"<div class='starCore'><div class='atar_Show'><p tip='"+data.list[i].star+"'></p></div>";
									    				pingCon+="</div></div><p class='pingCon'>"+data.list[i].content+"</p></div></div>";
					              		} 
					              	pingCon+="";
									    		$("#pingLun").append(pingCon);
											     $(".starCore p").each(function(index, element) {
											        var num=$(this).attr("tip");
											        var www=num*2*16;//
											        $(this).css("width",www);
											        //$(this).parent(".atar_Show").siblings("span").text(num+"分");
											    });
									     $('img').error(function(){
												$(this).attr("src","../images/default.png");
											});
					              },
					              error: function(xhr, type) {
					                console.info("服务器出错");
					              }
					          });
					          
								myScroll.refresh();		
						}
						 
					
						function pullDownAction () {
							setTimeout(function () {
								/* AjaxLoad();*/
								 setTimeout(function(){
								 	myScroll.refresh();	
								 }, 1000);
							}, 1000);
						}
						
						function pullUpAction () {
						setTimeout(function () {
							 AjaxLoad();
							setTimeout(function(){
								 	myScroll.refresh();	
								 }, 1000);	
						}, 1000);	
					}
						/**
						 * 初始化iScroll控件
						 */
						function loaded() {
				pullDownEl = document.getElementById('pullDown');
				pullDownOffset = pullDownEl.offsetHeight;
				pullUpEl = document.getElementById('pullUp');	
				pullUpOffset = pullUpEl.offsetHeight;
				
				myScroll = new iScroll('wrapper', {
					scrollbarClass: 'myScrollbar', /* 重要样式 */
					useTransition: false, /* 此属性不知用意，本人从true改为false */
					topOffset: pullDownOffset,
					onRefresh: function () {
						if (pullDownEl.className.match('loading')) {
							pullDownEl.className = '';
							pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
						} else if (pullUpEl.className.match('loading')) {
							pullUpEl.className = '';
							pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
						}
					},
					onScrollMove: function () {
						if (this.y > 5 && !pullDownEl.className.match('flip')) {
							pullDownEl.className = 'flip';
							pullDownEl.querySelector('.pullDownLabel').innerHTML = '松手开始更新...';
							this.minScrollY = 0;
						} else if (this.y < 5 && pullDownEl.className.match('flip')) {
							pullDownEl.className = '';
							pullDownEl.querySelector('.pullDownLabel').innerHTML = '下拉刷新...';
							this.minScrollY = -pullDownOffset;
						} else if (this.y < (this.maxScrollY - 5) && !pullUpEl.className.match('flip')) {
							pullUpEl.className = 'flip';
							pullUpEl.querySelector('.pullUpLabel').innerHTML = '松手开始更新...';
							this.maxScrollY = this.maxScrollY;
						} else if (this.y > (this.maxScrollY + 5) && pullUpEl.className.match('flip')) {
							pullUpEl.className = '';
							pullUpEl.querySelector('.pullUpLabel').innerHTML = '上拉加载更多...';
							this.maxScrollY = pullUpOffset;
						}
					},
					onScrollEnd: function () {
						if (pullDownEl.className.match('flip')) {
							pullDownEl.className = 'loading';
							pullDownEl.querySelector('.pullDownLabel').innerHTML = '加载中...';				
							pullDownAction();	// Execute custom function (ajax call?)
						} else if (pullUpEl.className.match('flip')) {
							pullUpEl.className = 'loading';
							pullUpEl.querySelector('.pullUpLabel').innerHTML = '加载中...';				
							pullUpAction();	// Execute custom function (ajax call?)
						}
					}
				});
				
				setTimeout(function () { document.getElementById('wrapper').style.left = '0'; }, 800);
			}
			
						
						//初始化绑定iScroll控件 
						//document.addEventListener('touchmove', function (e) { e.preventDefault(); }, false);
						document.addEventListener('DOMContentLoaded', loaded, false); 
			
			</script>
    </body>

</html>